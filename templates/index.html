<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KDP PDF Validator</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        /* Branding */
        :root { --amazon-orange:#FF9900; --amazon-dark:#232F3E; --amazon-font:'Amazon Ember',Arial,sans-serif; }
        body { background:#f2f3f5; font-family:var(--amazon-font); padding:2rem; }
        .main-container { max-width:800px; margin:auto; background:#fff; padding:2rem; border:1px solid #e0e0e0; border-radius:4px; }
        .header { background:var(--amazon-dark); color:#fff; padding:1rem; border-radius:4px; display:flex; align-items:center; margin-bottom:1.5rem; }
        .header img { height:40px; margin-right:1rem; }
        .header h1 { margin:0; color:var(--amazon-orange); font-size:1.75rem; }
        .dropzone { border:2px dashed #ccc; border-radius:4px; padding:2rem; text-align:center; background:#fafafa; cursor:pointer; }
        .dropzone:hover { background:#f0f0f0; }
        .dropzone-hover { border-color:var(--amazon-dark); background:#ddd; }
        .analysis-card { background:#fff; border:1px solid #ddd; border-radius:4px; padding:1.5rem; margin-bottom:1.5rem; }
        .analysis-header { display:flex; align-items:center; font-size:1.25rem; margin-bottom:1rem; }
        .analysis-header i { margin-right:0.5rem; }
        /* Amazon Orange button style */
        .btn-amazon {
            background-color: var(--amazon-orange) !important;
            border-color: var(--amazon-orange) !important;
            color: #fff !important;
        }
        .btn-amazon:hover {
            background-color: #e68a00 !important; /* Slightly darker on hover */
            border-color: #e68a00 !important;
        }
    </style>
</head>
<body>
    <div class="container main-container">
        <!-- KDP Header -->
        <div class="header bg-amazon-dark d-flex align-items-center mb-4" style="padding:1rem;border-radius:4px;">
            <img src="{{ url_for('static', filename='kdp-logo.png') }}" alt="KDP Logo" style="height:60px;margin-right:1rem;">
            <div>
                <h1 class="text-orange m-0">KDP PDF Validator</h1>
                <p class="lead m-0" style="color:#eaeaea;">Check if your PDF meets KDP's print guidelines</p>
            </div>
        </div>
        <!-- Upload Form -->
        <form id="pdfUploadForm" action="/upload" method="post" enctype="multipart/form-data">
            <div class="analysis-card upload-card">
                <h3 class="analysis-header"><i class="bi bi-file-earmark-pdf-fill"></i> Upload and Validate PDF</h3>
                <div class="dropzone" onclick="document.getElementById('pdfFile').click()">
                    <p>Drag &amp; drop your PDF here</p>
                    <p>or click to select a file</p>
                </div>
                <input type="file" id="pdfFile" name="file" accept="application/pdf" class="d-none" required>

                <div class="mb-3 mt-3">
                    <label for="bookType" class="form-label">Book Type</label>
                    <select class="form-select" id="bookType" name="book_type">
                        <option value="paperback" selected>Paperback</option>
                        <option value="hardcover">Hardcover</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="trimSize" class="form-label">Trim Size</label>
                    <select class="form-select" id="trimSize" name="trim_size" required>
                        <option value="" disabled selected>Choose trim size...</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="colorOption" class="form-label">Color Option</label>
                    <select class="form-select" id="colorOption" name="color_option" required>
                        {% for code, name in color_options.items() %}
                        <option value="{{ code }}">{{ name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="bleedCheck" name="include_bleed" value="true">
                    <label class="form-check-label" for="bleedCheck">Does it include Bleed?</label>
                </div>

                <button type="submit" class="btn btn-amazon w-100 mt-3">Check PDF</button>
            </div>
        </form>

        <!-- Footer -->
        <div class="text-center text-muted mt-3">
            <small>This tool checks your PDF against KDP's print guidelines. <a href="https://kdp.amazon.com/en_US/help/topic/G201834180" target="_blank">KDP Help Center</a></small>
        </div>
    </div>

    <!-- Hidden size data for JS -->
    <div id="sizeData" data-pb='{{ paperback_trim_sizes|tojson }}' data-hc='{{ hardcover_trim_sizes|tojson }}' style="display:none;"></div>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Book Type selection handlers -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // KDP trim sizes passed from server via hidden element
        const sizeDataEl = document.getElementById('sizeData');
        const pbSizes = JSON.parse(sizeDataEl.getAttribute('data-pb'));
        const hcSizes = JSON.parse(sizeDataEl.getAttribute('data-hc'));
        const bookTypeSelect = document.getElementById('bookType');
        const trimSizeSelect = document.getElementById('trimSize');
        const colorOptionSelect = document.getElementById('colorOption');
        const dropzone = document.querySelector('.dropzone');
        const pdfFileInput = document.getElementById('pdfFile');

        function populateTrimSizes(sizes) {
            trimSizeSelect.innerHTML = '<option value="" disabled selected>Choose trim size...</option>';
            sizes.forEach(size => {
                const opt = document.createElement('option');
                opt.value = size;
                opt.textContent = `${size} inches`;
                trimSizeSelect.appendChild(opt);
            });
        }

        function handleBookTypeChange() {
            const type = bookTypeSelect.value;
            // Populate trim sizes based on book type
            populateTrimSizes(type === 'paperback' ? pbSizes : hcSizes);
            const stdOpt = colorOptionSelect.querySelector('option[value="standard_color"]');
            if (stdOpt) {
                stdOpt.hidden = type === 'hardcover';
                stdOpt.disabled = type === 'hardcover';
                if (type === 'hardcover' && colorOptionSelect.value === 'standard_color') {
                    colorOptionSelect.selectedIndex = 0;
                }
            }
        }

        // Update trim sizes only on book type change
        bookTypeSelect.addEventListener('change', handleBookTypeChange);
        handleBookTypeChange();

        ['dragenter', 'dragover'].forEach(evt =>
            dropzone.addEventListener(evt, e => {
                e.preventDefault(); e.stopPropagation();
                dropzone.classList.add('dropzone-hover');
            })
        );
        // Handle file drop
        dropzone.addEventListener('dragleave', e => {
            e.preventDefault(); e.stopPropagation();
            dropzone.classList.remove('dropzone-hover');
        });
        dropzone.addEventListener('drop', e => {
            e.preventDefault(); e.stopPropagation();
            dropzone.classList.remove('dropzone-hover');
            if (e.dataTransfer.files.length) {
                // Use DataTransfer to set the file input
                const dt = new DataTransfer();
                for (const file of e.dataTransfer.files) {
                    dt.items.add(file);
                }
                pdfFileInput.files = dt.files;
                // Show the file name in the drop zone
                dropzone.innerHTML = `<p>${dt.files[0].name}</p>`;
            }
        });
        // Display selected file name when using file picker
        pdfFileInput.addEventListener('change', () => {
            if (pdfFileInput.files.length) {
                dropzone.innerHTML = `<p>${pdfFileInput.files[0].name}</p>`;
            }
        });
    });
    </script>
</body>
</html> 